document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('.fgb-fluid-group[data-fluid-enabled="true"]').forEach(function(e){const t=e.querySelector(".fgb-fluid-canvas");if(!t)return;const n=e.getAttribute("data-fluid-settings");let o={};try{o=JSON.parse(n)||{}}catch(e){console.error("Failed to parse fluid settings:",e)}!function(e,t){var n,o,r,i,a,l,u,s,c,f,d,m,v,h,g,p,x,T,E,R,y,b,S,w,D,F,_,L,M,B,A,C,O,U,P,I,X,N,Y,z,G,k,V,H,W,q,$,J,K,j,Q,Z;const ee={SIM_RESOLUTION:null!==(n=t.simResolution)&&void 0!==n?n:128,DYE_RESOLUTION:null!==(o=t.dyeResolution)&&void 0!==o?o:1024,DENSITY_DISSIPATION:null!==(r=t.densityDissipation)&&void 0!==r?r:.97,VELOCITY_DISSIPATION:null!==(i=t.velocityDissipation)&&void 0!==i?i:.98,PRESSURE:null!==(a=t.pressure)&&void 0!==a?a:.8,PRESSURE_ITERATIONS:20,CURL:null!==(l=t.curl)&&void 0!==l?l:30,SPLAT_RADIUS:null!==(u=t.splatRadius)&&void 0!==u?u:.25,SPLAT_FORCE:null!==(s=t.splatForce)&&void 0!==s?s:6e3,PROJECTION_DISTANCE:null!==(c=t.projectionDistance)&&void 0!==c?c:1,FADE_SPEED:null!==(f=t.fadeSpeed)&&void 0!==f?f:1,BLOOM:!1!==t.bloom,BLOOM_ITERATIONS:8,BLOOM_RESOLUTION:256,BLOOM_INTENSITY:null!==(d=t.bloomIntensity)&&void 0!==d?d:.8,BLOOM_THRESHOLD:null!==(m=t.bloomThreshold)&&void 0!==m?m:.6,BLOOM_SOFT_KNEE:.7,CALM_DOWN:null!==(v=t.calmDown)&&void 0!==v&&v,CALM_DOWN_DELAY:null!==(h=t.calmDownDelay)&&void 0!==h?h:2e3,CALM_DOWN_STRENGTH:null!==(g=t.calmDownStrength)&&void 0!==g?g:.9},te={saturation:null!==(p=t.colorSaturation)&&void 0!==p?p:1,brightness:null!==(x=t.colorBrightness)&&void 0!==x?x:.15,saturationBoost:null!==(T=t.saturationBoost)&&void 0!==T?T:1,fixedColor:null!==(E=t.fixedColor)&&void 0!==E?E:"#ff00ff",colorChangeDistance:null!==(R=t.colorChangeDistance)&&void 0!==R?R:0,colorMode:null!==(y=t.colorMode)&&void 0!==y?y:"rainbow",hueMin:null!==(b=t.hueMin)&&void 0!==b?b:0,hueMax:null!==(S=t.hueMax)&&void 0!==S?S:360,gradientSpeed:null!==(w=t.gradientSpeed)&&void 0!==w?w:.5,rainbowMode:!1!==t.rainbowMode,preventOverblending:null!==(D=t.preventOverblending)&&void 0!==D&&D,maxColorIntensity:null!==(F=t.maxColorIntensity)&&void 0!==F?F:1,darkMode:null!==(_=t.darkMode)&&void 0!==_&&_,blendMode:null!==(L=t.blendMode)&&void 0!==L?L:"normal",negativeBloom:null!==(M=t.negativeBloom)&&void 0!==M&&M},ne=t.elementInteraction||{},oe={enabled:null!==(B=ne.enabled)&&void 0!==B&&B,selectors:null!==(A=ne.selectors)&&void 0!==A?A:"",trackScroll:null!==(C=ne.trackScroll)&&void 0!==C&&C,mode:null!==(O=ne.mode)&&void 0!==O?O:"hardCorner",softEdgeRadius:null!==(U=ne.softEdgeRadius)&&void 0!==U?U:20,forceFieldStrength:null!==(P=ne.forceFieldStrength)&&void 0!==P?P:50,forceFieldRadius:null!==(I=ne.forceFieldRadius)&&void 0!==I?I:80,attractFieldStrength:null!==(X=ne.attractFieldStrength)&&void 0!==X?X:50,attractFieldRadius:null!==(N=ne.attractFieldRadius)&&void 0!==N?N:80,turbulenceIntensity:null!==(Y=ne.turbulenceIntensity)&&void 0!==Y?Y:30,turbulenceScale:null!==(z=ne.turbulenceScale)&&void 0!==z?z:50,affectNewSplats:!1!==ne.affectNewSplats,affectExistingFluid:null!==(G=ne.affectExistingFluid)&&void 0!==G&&G,edgeGlow:null!==(k=ne.edgeGlow)&&void 0!==k&&k,edgeGlowIntensity:null!==(V=ne.edgeGlowIntensity)&&void 0!==V?V:.5,edgeGlowDistance:null!==(H=ne.edgeGlowDistance)&&void 0!==H?H:15,edgeGlowMatchFluid:null===(W=ne.edgeGlowMatchFluid)||void 0===W||W,edgeGlowColor:null!==(q=ne.edgeGlowColor)&&void 0!==q?q:"#ffffff"},re={mode:null!==($=t.cursorMode)&&void 0!==$?$:"default",dotSize:null!==(J=t.dotCursor?.size)&&void 0!==J?J:10,dotColor:null!==(K=t.dotCursor?.color)&&void 0!==K?K:"#ffffff",crosshairThickness:null!==(j=t.crosshairCursor?.thickness)&&void 0!==j?j:1,crosshairColor:null!==(Q=t.crosshairCursor?.color)&&void 0!==Q?Q:"#ffffff",siblingHoverMode:null!==(Z=t.siblingHoverMode)&&void 0!==Z&&Z};let ie=[];function ae(){if(oe.enabled&&oe.selectors)try{const t=document.querySelectorAll(oe.selectors);ie=Array.from(t).map(t=>function(t){const n=e.getBoundingClientRect(),o=t.getBoundingClientRect();return{x:(o.left-n.left)/n.width,y:1-(o.bottom-n.top)/n.height,width:o.width/n.width,height:o.height/n.height,px:o.left-n.left,py:o.top-n.top,pWidth:o.width,pHeight:o.height}}(t))}catch(e){console.warn("Invalid element selectors:",e),ie=[]}else ie=[]}let le=Math.random(),ue=Date.now();e.style.mixBlendMode=te.blendMode,te.negativeBloom&&(e.style.filter="invert(1)");class se{constructor(){this.id=-1,this.texcoordX=0,this.texcoordY=0,this.prevTexcoordX=0,this.prevTexcoordY=0,this.deltaX=0,this.deltaY=0,this.down=!1,this.moved=!1,this.color={r:.5,g:.2,b:.8},this.distanceSinceColorChange=0}}let ce=[new se];function fe(e,t,n,o,r){if(!function(e,t,n,o){const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,t,4,4,0,n,o,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER);return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(i),e.deleteTexture(r),a===e.FRAMEBUFFER_COMPLETE}(e,t,n,o)){if(r)switch(t){case e.R16F:return fe(e,e.RG16F,e.RG,o,r);case e.RG16F:return fe(e,e.RGBA16F,e.RGBA,o,r)}return{internalFormat:e.RGBA,format:e.RGBA}}return{internalFormat:t,format:n}}const de=function(e){const t={alpha:!0,depth:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!1};let n=e.getContext("webgl2",t);const o=!!n;if(o||(n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),!n)return console.error("WebGL not supported"),null;let r,i,a,l,u;if(o)n.getExtension("EXT_color_buffer_float"),i=n.getExtension("OES_texture_float_linear"),r=n.HALF_FLOAT;else{const e=n.getExtension("OES_texture_half_float");r=e?e.HALF_FLOAT_OES:n.UNSIGNED_BYTE,i=n.getExtension("OES_texture_half_float_linear")}return n.clearColor(0,0,0,1),o?(a=fe(n,n.RGBA16F,n.RGBA,r,o),l=fe(n,n.RG16F,n.RG,r,o),u=fe(n,n.R16F,n.RED,r,o)):(a={internalFormat:n.RGBA,format:n.RGBA},l={internalFormat:n.RGBA,format:n.RGBA},u={internalFormat:n.RGBA,format:n.RGBA}),{gl:n,ext:{formatRGBA:a,formatRG:l,formatR:u,halfFloatTexType:r,supportLinearFiltering:!!i},isWebGL2:o}}(e);if(!de)return;const{gl:me,ext:ve,isWebGL2:he}=de;function ge(e,t){const n=me.createShader(e);return me.shaderSource(n,t),me.compileShader(n),me.getShaderParameter(n,me.COMPILE_STATUS)?n:(console.error("Shader error:",me.getShaderInfoLog(n)),me.deleteShader(n),null)}function pe(e,t){const n=ge(me.VERTEX_SHADER,e),o=ge(me.FRAGMENT_SHADER,t);if(!n||!o)return null;const r=me.createProgram();if(me.attachShader(r,n),me.attachShader(r,o),me.linkProgram(r),!me.getProgramParameter(r,me.LINK_STATUS))return console.error("Program error:",me.getProgramInfoLog(r)),null;const i={},a=me.getProgramParameter(r,me.ACTIVE_UNIFORMS);for(let e=0;e<a;e++){const t=me.getActiveUniform(r,e).name;i[t]=me.getUniformLocation(r,t)}return{program:r,uniforms:i}}const xe="\n        precision highp float;\n        attribute vec2 aPosition;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform vec2 texelSize;\n        \n        void main () {\n            vUv = aPosition * 0.5 + 0.5;\n            vL = vUv - vec2(texelSize.x, 0.0);\n            vR = vUv + vec2(texelSize.x, 0.0);\n            vT = vUv + vec2(0.0, texelSize.y);\n            vB = vUv - vec2(0.0, texelSize.y);\n            gl_Position = vec4(aPosition, 0.0, 1.0);\n        }\n    ",Te="\n        precision highp float;\n        attribute vec2 aPosition;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        uniform vec2 texelSize;\n        \n        void main () {\n            vUv = aPosition * 0.5 + 0.5;\n            float offset = 1.33333333;\n            vL = vUv - texelSize * offset;\n            vR = vUv + texelSize * offset;\n            gl_Position = vec4(aPosition, 0.0, 1.0);\n        }\n    ",Ee={copy:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        \n        void main () {\n            gl_FragColor = texture2D(uTexture, vUv);\n        }\n    "),clear:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform float value;\n        \n        void main () {\n            gl_FragColor = value * texture2D(uTexture, vUv);\n        }\n    "),display:pe(xe,"\n        precision highp float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform sampler2D uBloom;\n        uniform bool useBloom;\n        \n        void main () {\n            vec3 c = texture2D(uTexture, vUv).rgb;\n            if (useBloom) {\n                vec3 bloom = texture2D(uBloom, vUv).rgb;\n                c += bloom;\n            }\n            float a = max(c.r, max(c.g, c.b));\n            gl_FragColor = vec4(c, a);\n        }\n    "),bloomPrefilter:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform vec3 curve;\n        uniform float threshold;\n        \n        void main () {\n            vec3 c = texture2D(uTexture, vUv).rgb;\n            float br = max(c.r, max(c.g, c.b));\n            float rq = clamp(br - curve.x, 0.0, curve.y);\n            rq = curve.z * rq * rq;\n            c *= max(rq, br - threshold) / max(br, 0.0001);\n            gl_FragColor = vec4(c, 0.0);\n        }\n    "),bloomBlur:pe(Te,"\n        precision mediump float;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        \n        void main () {\n            vec4 sum = vec4(0.0);\n            sum += texture2D(uTexture, vL);\n            sum += texture2D(uTexture, vR);\n            sum *= 0.5;\n            gl_FragColor = sum;\n        }\n    "),bloomFinal:pe(Te,"\n        precision mediump float;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform float intensity;\n        \n        void main () {\n            vec4 sum = vec4(0.0);\n            sum += texture2D(uTexture, vL);\n            sum += texture2D(uTexture, vR);\n            sum *= 0.5 * intensity;\n            gl_FragColor = sum;\n        }\n    "),splat:pe(xe,"\n        precision highp float;\n        varying vec2 vUv;\n        uniform sampler2D uTarget;\n        uniform float aspectRatio;\n        uniform vec3 color;\n        uniform vec2 point;\n        uniform float radius;\n        \n        void main () {\n            vec2 p = vUv - point.xy;\n            p.x *= aspectRatio;\n            vec3 splat = exp(-dot(p, p) / radius) * color;\n            vec3 base = texture2D(uTarget, vUv).xyz;\n            gl_FragColor = vec4(base + splat, 1.0);\n        }\n    "),advection:pe(xe,"\n        precision highp float;\n        varying vec2 vUv;\n        uniform sampler2D uVelocity;\n        uniform sampler2D uSource;\n        uniform vec2 texelSize;\n        uniform vec2 dyeTexelSize;\n        uniform float dt;\n        uniform float dissipation;\n        \n        void main () {\n            vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n            vec4 result = texture2D(uSource, coord);\n            float decay = 1.0 + dissipation * dt;\n            gl_FragColor = result / decay;\n        }\n    "),divergence:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uVelocity;\n        \n        void main () {\n            float L = texture2D(uVelocity, vL).x;\n            float R = texture2D(uVelocity, vR).x;\n            float T = texture2D(uVelocity, vT).y;\n            float B = texture2D(uVelocity, vB).y;\n            vec2 C = texture2D(uVelocity, vUv).xy;\n            if (vL.x < 0.0) { L = -C.x; }\n            if (vR.x > 1.0) { R = -C.x; }\n            if (vT.y > 1.0) { T = -C.y; }\n            if (vB.y < 0.0) { B = -C.y; }\n            float div = 0.5 * (R - L + T - B);\n            gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n        }\n    "),curl:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uVelocity;\n        \n        void main () {\n            float L = texture2D(uVelocity, vL).y;\n            float R = texture2D(uVelocity, vR).y;\n            float T = texture2D(uVelocity, vT).x;\n            float B = texture2D(uVelocity, vB).x;\n            float vorticity = R - L - T + B;\n            gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\n        }\n    "),vorticity:pe(xe,"\n        precision highp float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uVelocity;\n        uniform sampler2D uCurl;\n        uniform float curl;\n        uniform float dt;\n        \n        void main () {\n            float L = texture2D(uCurl, vL).x;\n            float R = texture2D(uCurl, vR).x;\n            float T = texture2D(uCurl, vT).x;\n            float B = texture2D(uCurl, vB).x;\n            float C = texture2D(uCurl, vUv).x;\n            vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n            force /= length(force) + 0.0001;\n            force *= curl * C;\n            force.y *= -1.0;\n            vec2 vel = texture2D(uVelocity, vUv).xy;\n            gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\n        }\n    "),pressure:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uPressure;\n        uniform sampler2D uDivergence;\n        \n        void main () {\n            float L = texture2D(uPressure, vL).x;\n            float R = texture2D(uPressure, vR).x;\n            float T = texture2D(uPressure, vT).x;\n            float B = texture2D(uPressure, vB).x;\n            float C = texture2D(uPressure, vUv).x;\n            float divergence = texture2D(uDivergence, vUv).x;\n            float pressure = (L + R + B + T - divergence) * 0.25;\n            gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n        }\n    "),gradientSubtract:pe(xe,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uPressure;\n        uniform sampler2D uVelocity;\n        \n        void main () {\n            float L = texture2D(uPressure, vL).x;\n            float R = texture2D(uPressure, vR).x;\n            float T = texture2D(uPressure, vT).x;\n            float B = texture2D(uPressure, vB).x;\n            vec2 velocity = texture2D(uVelocity, vUv).xy;\n            velocity.xy -= vec2(R - L, T - B);\n            gl_FragColor = vec4(velocity, 0.0, 1.0);\n        }\n    ")},Re=me.createBuffer();me.bindBuffer(me.ARRAY_BUFFER,Re),me.bufferData(me.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),me.STATIC_DRAW);const ye=me.createBuffer();function be(e,t=!1){null==e?(me.viewport(0,0,me.drawingBufferWidth,me.drawingBufferHeight),me.bindFramebuffer(me.FRAMEBUFFER,null)):(me.viewport(0,0,e.width,e.height),me.bindFramebuffer(me.FRAMEBUFFER,e.fbo)),t&&(me.clearColor(0,0,0,1),me.clear(me.COLOR_BUFFER_BIT)),me.bindBuffer(me.ARRAY_BUFFER,Re),me.bindBuffer(me.ELEMENT_ARRAY_BUFFER,ye),me.enableVertexAttribArray(0),me.vertexAttribPointer(0,2,me.FLOAT,!1,0,0),me.drawElements(me.TRIANGLES,6,me.UNSIGNED_SHORT,0)}let Se,we,De,Fe,_e,Le;me.bindBuffer(me.ELEMENT_ARRAY_BUFFER,ye),me.bufferData(me.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),me.STATIC_DRAW);let Me=[];function Be(e){let t=me.drawingBufferWidth/me.drawingBufferHeight;t<1&&(t=1/t);const n=Math.round(e),o=Math.round(e*t);return me.drawingBufferWidth>me.drawingBufferHeight?{width:o,height:n}:{width:n,height:o}}function Ae(e,t,n,o,r,i){me.activeTexture(me.TEXTURE0);const a=me.createTexture();me.bindTexture(me.TEXTURE_2D,a),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,i),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,i),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texImage2D(me.TEXTURE_2D,0,n,e,t,0,o,r,null);const l=me.createFramebuffer();return me.bindFramebuffer(me.FRAMEBUFFER,l),me.framebufferTexture2D(me.FRAMEBUFFER,me.COLOR_ATTACHMENT0,me.TEXTURE_2D,a,0),me.viewport(0,0,e,t),me.clear(me.COLOR_BUFFER_BIT),{texture:a,fbo:l,width:e,height:t,texelSizeX:1/e,texelSizeY:1/t,attach:e=>(me.activeTexture(me.TEXTURE0+e),me.bindTexture(me.TEXTURE_2D,a),e)}}function Ce(e,t,n,o,r,i){let a=Ae(e,t,n,o,r,i),l=Ae(e,t,n,o,r,i);return{width:e,height:t,texelSizeX:a.texelSizeX,texelSizeY:a.texelSizeY,get read(){return a},set read(e){a=e},get write(){return l},set write(e){l=e},swap(){const e=a;a=l,l=e}}}const Oe=e.closest(".fgb-fluid-group");let Ue,Pe=0,Ie=0;function Xe(){const t=Oe.offsetWidth||300,n=Oe.offsetHeight||200;if(Math.abs(t-Pe)>1||Math.abs(n-Ie)>1){const o=4096,r=Math.min(Math.max(t,100),o),i=Math.min(Math.max(n,100),o);return e.width=r,e.height=i,Pe=t,Ie=n,!0}return!1}function Ne(){const e=Be(ee.SIM_RESOLUTION),t=Be(ee.DYE_RESOLUTION),n=ve.halfFloatTexType,o=ve.formatRGBA,r=ve.formatRG,i=ve.formatR,a=ve.supportLinearFiltering?me.LINEAR:me.NEAREST;Se=Ce(t.width,t.height,o.internalFormat,o.format,n,a),we=Ce(e.width,e.height,r.internalFormat,r.format,n,a),De=Ae(e.width,e.height,i.internalFormat,i.format,n,me.NEAREST),Fe=Ae(e.width,e.height,i.internalFormat,i.format,n,me.NEAREST),_e=Ce(e.width,e.height,i.internalFormat,i.format,n,me.NEAREST),function(){const e=Be(ee.BLOOM_RESOLUTION),t=ve.halfFloatTexType,n=ve.formatRGBA,o=ve.supportLinearFiltering?me.LINEAR:me.NEAREST;Le=Ae(e.width,e.height,n.internalFormat,n.format,t,o),Me.length=0;for(let r=0;r<ee.BLOOM_ITERATIONS;r++){const i=e.width>>r+1,a=e.height>>r+1;if(i<2||a<2)break;const l=Ae(i,a,n.internalFormat,n.format,t,o);Me.push(l)}}()}function Ye(){let e;const t=Math.min(te.saturation*te.saturationBoost,1);switch(te.colorMode||"rainbow"){case"rainbow":e=ze(Math.random(),t,1);break;case"huerange":const n=te.hueMin/360,o=te.hueMax/360;let r;if(n<=o)r=n+Math.random()*(o-n);else{const e=1-n+o;r=n+Math.random()*e,r>1&&(r-=1)}e=ze(r,t,1);break;case"gradient":le+=.01*te.gradientSpeed,le>1&&(le-=1),e=ze(le,t,1);break;default:e=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:1,g:0,b:1}}(te.fixedColor||"#ff00ff")}if(e.r*=te.brightness,e.g*=te.brightness,e.b*=te.brightness,te.preventOverblending){const t=te.maxColorIntensity;e.r=Math.min(e.r,t),e.g=Math.min(e.g,t),e.b=Math.min(e.b,t)}return te.darkMode&&(e.r=-e.r,e.g=-e.g,e.b=-e.b),e}function ze(e,t,n){let o,r,i;const a=Math.floor(6*e),l=6*e-a,u=n*(1-t),s=n*(1-l*t),c=n*(1-(1-l)*t);switch(a%6){case 0:o=n,r=c,i=u;break;case 1:o=s,r=n,i=u;break;case 2:o=u,r=n,i=c;break;case 3:o=u,r=s,i=n;break;case 4:o=c,r=u,i=n;break;case 5:o=n,r=u,i=s}return{r:o,g:r,b:i}}window.addEventListener("resize",function(){clearTimeout(Ue),Ue=setTimeout(function(){Xe()&&Ne(),ae()},100)}),oe.enabled&&oe.trackScroll&&window.addEventListener("scroll",function(){ae()},{passive:!0}),oe.enabled&&setTimeout(ae,200),Xe(),Ne();let Ge=Date.now();function ke(t,n,o,r,i){ue=Date.now(),me.useProgram(Ee.splat.program),me.uniform1i(Ee.splat.uniforms.uTarget,we.read.attach(0)),me.uniform1f(Ee.splat.uniforms.aspectRatio,e.width/e.height),me.uniform2f(Ee.splat.uniforms.point,t,n),me.uniform3f(Ee.splat.uniforms.color,o,r,0),me.uniform1f(Ee.splat.uniforms.radius,function(t){const n=e.width/e.height;return n>1&&(t*=n),t}(ee.SPLAT_RADIUS/100)),be(we.write),we.swap(),me.uniform1i(Ee.splat.uniforms.uTarget,Se.read.attach(0)),me.uniform3f(Ee.splat.uniforms.color,i.r,i.g,i.b),be(Se.write),Se.swap()}re.siblingHoverMode?(document.addEventListener("mousemove",t=>{const n=e.getBoundingClientRect();t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom&&Je(ce[0],t.clientX-n.left,t.clientY-n.top)}),document.addEventListener("mousedown",t=>{const n=e.getBoundingClientRect();if(t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom){const e=ce[0];e.down=!0,e.color=Ye()}}),document.addEventListener("mouseup",()=>{ce[0].down=!1})):(Oe.addEventListener("mousemove",t=>{const n=ce[0],o=e.getBoundingClientRect();Je(n,t.clientX-o.left,t.clientY-o.top)}),Oe.addEventListener("mousedown",()=>{const e=ce[0];e.down=!0,e.color=Ye()}),Oe.addEventListener("mouseup",()=>{ce[0].down=!1}));let Ve=null,He=null,We=null;function qe(e,t,n){const o=re.mode;"dot"===o&&Ve?n?(Ve.style.display="block",Ve.style.left=e+"px",Ve.style.top=t+"px"):Ve.style.display="none":"crosshair"===o&&He&&We&&(n?(He.style.display="block",We.style.display="block",He.style.top=t+"px",We.style.left=e+"px"):(He.style.display="none",We.style.display="none"))}function $e(t,n,o,r){t.id=n,t.down=!0,t.moved=!1,t.texcoordX=o/e.width,t.texcoordY=1-r/e.height,t.prevTexcoordX=t.texcoordX,t.prevTexcoordY=t.texcoordY,t.deltaX=0,t.deltaY=0,t.color=Ye()}function Je(t,n,o){if(t.prevTexcoordX=t.texcoordX,t.prevTexcoordY=t.texcoordY,t.texcoordX=n/e.width,t.texcoordY=1-o/e.height,t.deltaX=function(t){const n=e.width/e.height;return n<1&&(t*=n),t}(t.texcoordX-t.prevTexcoordX),t.deltaY=function(t){const n=e.width/e.height;return n>1&&(t/=n),t}(t.texcoordY-t.prevTexcoordY),t.moved=Math.abs(t.deltaX)>0||Math.abs(t.deltaY)>0,t.moved){const n=t.deltaX*e.width,o=t.deltaY*e.height,r=Math.sqrt(n*n+o*o);t.distanceSinceColorChange+=r;const i=te.colorChangeDistance;(0===i||t.distanceSinceColorChange>=i)&&(t.color=Ye(),t.distanceSinceColorChange=0)}}"default"!==re.mode&&(function(){const e=re.mode;"hidden"===e?Oe.style.cursor="none":"dot"===e?(Oe.style.cursor="none",Ve=document.createElement("div"),Ve.className="fgb-dot-cursor",Ve.style.cssText=`\n                position: fixed;\n                pointer-events: none;\n                z-index: 999999;\n                width: ${re.dotSize}px;\n                height: ${re.dotSize}px;\n                background-color: ${re.dotColor};\n                border-radius: 50%;\n                transform: translate(-50%, -50%);\n                display: none;\n            `,document.body.appendChild(Ve)):"crosshair"===e&&(Oe.style.cursor="none",He=document.createElement("div"),He.className="fgb-crosshair-h",He.style.cssText=`\n                position: fixed;\n                left: 0;\n                right: 0;\n                height: ${re.crosshairThickness}px;\n                background-color: ${re.crosshairColor};\n                pointer-events: none;\n                z-index: 999999;\n                display: none;\n            `,document.body.appendChild(He),We=document.createElement("div"),We.className="fgb-crosshair-v",We.style.cssText=`\n                position: fixed;\n                top: 0;\n                bottom: 0;\n                width: ${re.crosshairThickness}px;\n                background-color: ${re.crosshairColor};\n                pointer-events: none;\n                z-index: 999999;\n                display: none;\n            `,document.body.appendChild(We))}(),Oe.addEventListener("mouseenter",()=>{"dot"===re.mode&&Ve?Ve.style.display="block":"crosshair"===re.mode&&(He&&(He.style.display="block"),We&&(We.style.display="block"))}),Oe.addEventListener("mouseleave",()=>{qe(0,0,!1)}),window.addEventListener("mousemove",e=>{const t=Oe.getBoundingClientRect(),n=e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom;qe(e.clientX,e.clientY,n)})),Oe.addEventListener("touchstart",t=>{const n=t.targetTouches;for(;n.length>=ce.length;)ce.push(new se);for(let t=0;t<n.length;t++){const o=e.getBoundingClientRect(),r=n[t].clientX-o.left,i=n[t].clientY-o.top;$e(ce[t+1],n[t].identifier,r,i)}},{passive:!0}),Oe.addEventListener("touchmove",t=>{const n=t.targetTouches;for(let t=0;t<n.length;t++){const o=ce[t+1];if(!o||!o.down)continue;const r=e.getBoundingClientRect();Je(o,n[t].clientX-r.left,n[t].clientY-r.top)}},{passive:!0}),Oe.addEventListener("touchend",e=>{const t=e.changedTouches;for(let e=0;e<t.length;e++){const n=ce.find(n=>n.id===t[e].identifier);n&&(n.down=!1)}}),function(e){for(let t=0;t<e;t++){const e=Ye();e.r*=10,e.g*=10,e.b*=10,ke(Math.random(),Math.random(),1e3*(Math.random()-.5),1e3*(Math.random()-.5),e)}}(parseInt(5*Math.random())+5),function t(){const n=function(){const e=Date.now();let t=(e-Ge)/1e3;return t=Math.min(t,.016666),Ge=e,t}();var o;ce.forEach(t=>{t.moved&&(t.moved=!1,function(t){let n=t.deltaX*ee.SPLAT_FORCE*ee.PROJECTION_DISTANCE,o=t.deltaY*ee.SPLAT_FORCE*ee.PROJECTION_DISTANCE,r=t.color;if(oe.enabled&&oe.affectNewSplats){const i=function(t,n){if(!oe.enabled||0===ie.length)return{blocked:!1,forceX:0,forceY:0,opacity:1};const o=oe.mode;let r={blocked:!1,forceX:0,forceY:0,opacity:1};for(const i of ie){const a=t>=i.x&&t<=i.x+i.width,l=n>=i.y&&n<=i.y+i.height,u=a&&l,s=i.x+i.width/2,c=i.y+i.height/2,f=(e.width,e.height,(t-s)*e.width),d=(n-c)*e.height,m=Math.sqrt(f*f+d*d),v=i.pWidth/2,h=i.pHeight/2,g=u?0:Math.max(0,Math.min(Math.abs((t-s)*e.width)-v,Math.abs((n-c)*e.height)-h));switch(o){case"hardCorner":u&&(r.blocked=!0,r.opacity=0);break;case"softEdge":const e=oe.softEdgeRadius;u?(r.blocked=!0,r.opacity=0):g<e&&(r.opacity=Math.min(r.opacity,g/e));break;case"forceField":const t=oe.forceFieldRadius;if(m<t+v){const e=(1-m/(t+v))*oe.forceFieldStrength,n=Math.atan2(d,f);r.forceX+=Math.cos(n)*e,r.forceY+=Math.sin(n)*e}u&&(r.blocked=!0);break;case"attractField":const n=oe.attractFieldRadius;if(m<n+v&&!u){const e=(1-m/(n+v))*oe.attractFieldStrength,t=Math.atan2(d,f);r.forceX-=Math.cos(t)*e,r.forceY-=Math.sin(t)*e}break;case"turbulence":const o=i.pWidth,a=oe.turbulenceIntensity,l=oe.turbulenceScale;if(m<2*o&&!u){const e=Math.atan2(d,f)+Math.PI/2,t=(1-m/(2*o))*a;r.forceX+=Math.cos(e)*t*(.5*Math.sin(Date.now()/l)+.5),r.forceY+=Math.sin(e)*t*(.5*Math.cos(Date.now()/l)+.5)}}}return r}(t.texcoordX,t.texcoordY);if(i.blocked)return;n+=i.forceX,o+=i.forceY,r={r:t.color.r*i.opacity,g:t.color.g*i.opacity,b:t.color.b*i.opacity}}ke(t.texcoordX,t.texcoordY,n,o,r)}(t))}),function(t){me.disable(me.BLEND),me.useProgram(Ee.curl.program),me.uniform2f(Ee.curl.uniforms.texelSize,we.texelSizeX,we.texelSizeY),me.uniform1i(Ee.curl.uniforms.uVelocity,we.read.attach(0)),be(Fe),me.useProgram(Ee.vorticity.program),me.uniform2f(Ee.vorticity.uniforms.texelSize,we.texelSizeX,we.texelSizeY),me.uniform1i(Ee.vorticity.uniforms.uVelocity,we.read.attach(0)),me.uniform1i(Ee.vorticity.uniforms.uCurl,Fe.attach(1)),me.uniform1f(Ee.vorticity.uniforms.curl,ee.CURL),me.uniform1f(Ee.vorticity.uniforms.dt,t),be(we.write),we.swap(),me.useProgram(Ee.divergence.program),me.uniform2f(Ee.divergence.uniforms.texelSize,we.texelSizeX,we.texelSizeY),me.uniform1i(Ee.divergence.uniforms.uVelocity,we.read.attach(0)),be(De),me.useProgram(Ee.clear.program),me.uniform1i(Ee.clear.uniforms.uTexture,_e.read.attach(0)),me.uniform1f(Ee.clear.uniforms.value,ee.PRESSURE),be(_e.write),_e.swap(),me.useProgram(Ee.pressure.program),me.uniform2f(Ee.pressure.uniforms.texelSize,we.texelSizeX,we.texelSizeY),me.uniform1i(Ee.pressure.uniforms.uDivergence,De.attach(0));for(let e=0;e<ee.PRESSURE_ITERATIONS;e++)me.uniform1i(Ee.pressure.uniforms.uPressure,_e.read.attach(1)),be(_e.write),_e.swap();me.useProgram(Ee.gradientSubtract.program),me.uniform2f(Ee.gradientSubtract.uniforms.texelSize,we.texelSizeX,we.texelSizeY),me.uniform1i(Ee.gradientSubtract.uniforms.uPressure,_e.read.attach(0)),me.uniform1i(Ee.gradientSubtract.uniforms.uVelocity,we.read.attach(1)),be(we.write),we.swap(),me.useProgram(Ee.advection.program),me.uniform2f(Ee.advection.uniforms.texelSize,we.texelSizeX,we.texelSizeY),me.uniform2f(Ee.advection.uniforms.dyeTexelSize,we.texelSizeX,we.texelSizeY);const n=we.read.attach(0);me.uniform1i(Ee.advection.uniforms.uVelocity,n),me.uniform1i(Ee.advection.uniforms.uSource,n),me.uniform1f(Ee.advection.uniforms.dt,t);let o=ee.VELOCITY_DISSIPATION;if(ee.CALM_DOWN){const e=Date.now()-ue;if(e>ee.CALM_DOWN_DELAY){const t=Math.min((e-ee.CALM_DOWN_DELAY)/1e3,1);o=ee.VELOCITY_DISSIPATION*(1-t)+ee.CALM_DOWN_STRENGTH*t}}me.uniform1f(Ee.advection.uniforms.dissipation,o),be(we.write),we.swap(),me.uniform2f(Ee.advection.uniforms.dyeTexelSize,Se.texelSizeX,Se.texelSizeY),me.uniform1i(Ee.advection.uniforms.uVelocity,we.read.attach(0)),me.uniform1i(Ee.advection.uniforms.uSource,Se.read.attach(1));const r=ee.DENSITY_DISSIPATION/ee.FADE_SPEED;me.uniform1f(Ee.advection.uniforms.dissipation,r),be(Se.write),Se.swap(),oe.enabled&&oe.affectExistingFluid&&ie.length>0&&function(){const t=oe.mode;for(const n of ie){const o=n.x+n.width/2,r=n.y+n.height/2;switch(t){case"hardCorner":case"softEdge":const i="softEdge"===t?.5*Math.max(n.width,n.height)+oe.softEdgeRadius/e.width:.4*Math.max(n.width,n.height);me.useProgram(Ee.splat.program),me.uniform1i(Ee.splat.uniforms.uTarget,we.read.attach(0)),me.uniform1f(Ee.splat.uniforms.aspectRatio,e.width/e.height),me.uniform2f(Ee.splat.uniforms.point,o,r),me.uniform3f(Ee.splat.uniforms.color,0,0,0),me.uniform1f(Ee.splat.uniforms.radius,.5*i),be(we.write),we.swap(),me.uniform1i(Ee.splat.uniforms.uTarget,Se.read.attach(0));const a="softEdge"===t?-.02:-.05;me.uniform3f(Ee.splat.uniforms.color,a,a,a),me.uniform1f(Ee.splat.uniforms.radius,.5*i),be(Se.write),Se.swap();break;case"forceField":const l=oe.forceFieldRadius/e.width+.5*n.width,u=.01*oe.forceFieldStrength;me.useProgram(Ee.splat.program),me.uniform1i(Ee.splat.uniforms.uTarget,we.read.attach(0)),me.uniform1f(Ee.splat.uniforms.aspectRatio,e.width/e.height),me.uniform2f(Ee.splat.uniforms.point,o,r),me.uniform3f(Ee.splat.uniforms.color,u,u,0),me.uniform1f(Ee.splat.uniforms.radius,l),be(we.write),we.swap();break;case"attractField":const s=oe.attractFieldRadius/e.width+.5*n.width,c=.005*-oe.attractFieldStrength;me.useProgram(Ee.splat.program),me.uniform1i(Ee.splat.uniforms.uTarget,we.read.attach(0)),me.uniform1f(Ee.splat.uniforms.aspectRatio,e.width/e.height),me.uniform2f(Ee.splat.uniforms.point,o,r),me.uniform3f(Ee.splat.uniforms.color,c,c,0),me.uniform1f(Ee.splat.uniforms.radius,s),be(we.write),we.swap();break;case"turbulence":const f=n.width+oe.turbulenceIntensity/e.width,d=.001*oe.turbulenceIntensity,m=Date.now()/oe.turbulenceScale,v=Math.sin(m)*d;me.useProgram(Ee.splat.program),me.uniform1i(Ee.splat.uniforms.uTarget,we.read.attach(0)),me.uniform1f(Ee.splat.uniforms.aspectRatio,e.width/e.height),me.uniform2f(Ee.splat.uniforms.point,o,r),me.uniform3f(Ee.splat.uniforms.color,v,.5*-v,0),me.uniform1f(Ee.splat.uniforms.radius,f),be(we.write),we.swap()}}}()}(n),o=null,ee.BLOOM&&Me.length>=2&&function(e,t){if(Me.length<2)return;let n=t;me.disable(me.BLEND),me.useProgram(Ee.bloomPrefilter.program);const o=ee.BLOOM_THRESHOLD*ee.BLOOM_SOFT_KNEE+1e-4,r=ee.BLOOM_THRESHOLD-o,i=2*o,a=.25/o;me.uniform3f(Ee.bloomPrefilter.uniforms.curve,r,i,a),me.uniform1f(Ee.bloomPrefilter.uniforms.threshold,ee.BLOOM_THRESHOLD),me.uniform1i(Ee.bloomPrefilter.uniforms.uTexture,e.attach(0)),be(n),me.useProgram(Ee.bloomBlur.program);for(let e=0;e<Me.length;e++){const t=Me[e];me.uniform2f(Ee.bloomBlur.uniforms.texelSize,n.texelSizeX,n.texelSizeY),me.uniform1i(Ee.bloomBlur.uniforms.uTexture,n.attach(0)),be(t),n=t}me.blendFunc(me.ONE,me.ONE),me.enable(me.BLEND);for(let e=Me.length-2;e>=0;e--){const t=Me[e];me.uniform2f(Ee.bloomBlur.uniforms.texelSize,n.texelSizeX,n.texelSizeY),me.uniform1i(Ee.bloomBlur.uniforms.uTexture,n.attach(0)),me.viewport(0,0,t.width,t.height),be(t),n=t}me.disable(me.BLEND),me.useProgram(Ee.bloomFinal.program),me.uniform2f(Ee.bloomFinal.uniforms.texelSize,n.texelSizeX,n.texelSizeY),me.uniform1i(Ee.bloomFinal.uniforms.uTexture,n.attach(0)),me.uniform1f(Ee.bloomFinal.uniforms.intensity,ee.BLOOM_INTENSITY),be(t)}(Se.read,Le),function(e){const t=null==e?me.drawingBufferWidth:e.width,n=null==e?me.drawingBufferHeight:e.height;me.useProgram(Ee.display.program),me.uniform2f(Ee.display.uniforms.texelSize,1/t,1/n),me.uniform1i(Ee.display.uniforms.uTexture,Se.read.attach(0)),ee.BLOOM&&Me.length>=2?(me.uniform1i(Ee.display.uniforms.uBloom,Le.attach(1)),me.uniform1i(Ee.display.uniforms.useBloom,1)):me.uniform1i(Ee.display.uniforms.useBloom,0),be(e)}(o),requestAnimationFrame(t)}()}(t,o)})});