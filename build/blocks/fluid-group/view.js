document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('.fgb-fluid-group[data-fluid-enabled="true"]').forEach(function(e){const t=e.querySelector(".fgb-fluid-canvas");if(!t)return;const n=e.getAttribute("data-fluid-settings"),o=e.getAttribute("data-initial-shapes");let r={},i=[];try{r=JSON.parse(n)||{}}catch(e){console.error("Failed to parse fluid settings:",e)}try{i=o?JSON.parse(o):[]}catch(e){console.error("Failed to parse initial shapes:",e)}!function(e,t,n=[]){var o,r,i,a,l,s,u,c,f,d,m,v,h,g,p,x,T,E,R,y,b,S,w,M,D,F,_,L,A,B,C,O,U,I,P,N,X,Y,z,k,G,V,H,W,q,$,J,j,K,Q,Z,ee,te,ne,oe;const re={SIM_RESOLUTION:null!==(o=t.simResolution)&&void 0!==o?o:128,DYE_RESOLUTION:null!==(r=t.dyeResolution)&&void 0!==r?r:1024,DENSITY_DISSIPATION:null!==(i=t.densityDissipation)&&void 0!==i?i:.97,VELOCITY_DISSIPATION:null!==(a=t.velocityDissipation)&&void 0!==a?a:.98,PRESSURE:null!==(l=t.pressure)&&void 0!==l?l:.8,PRESSURE_ITERATIONS:20,CURL:null!==(s=t.curl)&&void 0!==s?s:30,SPLAT_RADIUS:null!==(u=t.splatRadius)&&void 0!==u?u:.25,SPLAT_FORCE:null!==(c=t.splatForce)&&void 0!==c?c:6e3,PROJECTION_DISTANCE:null!==(f=t.projectionDistance)&&void 0!==f?f:1,FADE_SPEED:null!==(d=t.fadeSpeed)&&void 0!==d?d:1,BLOOM:!1!==t.bloom,BLOOM_ITERATIONS:8,BLOOM_RESOLUTION:256,BLOOM_INTENSITY:null!==(m=t.bloomIntensity)&&void 0!==m?m:.8,BLOOM_THRESHOLD:null!==(v=t.bloomThreshold)&&void 0!==v?v:.6,BLOOM_SOFT_KNEE:.7,CALM_DOWN:null!==(h=t.calmDown)&&void 0!==h&&h,CALM_DOWN_DELAY:null!==(g=t.calmDownDelay)&&void 0!==g?g:2e3,CALM_DOWN_STRENGTH:null!==(p=t.calmDownStrength)&&void 0!==p?p:.9},ie={saturation:null!==(x=t.colorSaturation)&&void 0!==x?x:1,brightness:null!==(T=t.colorBrightness)&&void 0!==T?T:.15,saturationBoost:null!==(E=t.saturationBoost)&&void 0!==E?E:1,fixedColor:null!==(R=t.fixedColor)&&void 0!==R?R:"#ff00ff",colorChangeDistance:null!==(y=t.colorChangeDistance)&&void 0!==y?y:0,colorMode:null!==(b=t.colorMode)&&void 0!==b?b:"rainbow",hueMin:null!==(S=t.hueMin)&&void 0!==S?S:0,hueMax:null!==(w=t.hueMax)&&void 0!==w?w:360,gradientSpeed:null!==(M=t.gradientSpeed)&&void 0!==M?M:.5,rainbowMode:!1!==t.rainbowMode,preventOverblending:null!==(D=t.preventOverblending)&&void 0!==D&&D,maxColorIntensity:null!==(F=t.maxColorIntensity)&&void 0!==F?F:1,darkMode:null!==(_=t.darkMode)&&void 0!==_&&_,blendMode:null!==(L=t.blendMode)&&void 0!==L?L:"normal",negativeBloom:null!==(A=t.negativeBloom)&&void 0!==A&&A},ae=t.elementInteraction||{},le={enabled:null!==(B=ae.enabled)&&void 0!==B&&B,selectors:null!==(C=ae.selectors)&&void 0!==C?C:"",trackScroll:null!==(O=ae.trackScroll)&&void 0!==O&&O,mode:null!==(U=ae.mode)&&void 0!==U?U:"hardCorner",softEdgeRadius:null!==(I=ae.softEdgeRadius)&&void 0!==I?I:20,forceFieldStrength:null!==(P=ae.forceFieldStrength)&&void 0!==P?P:50,forceFieldRadius:null!==(N=ae.forceFieldRadius)&&void 0!==N?N:80,attractFieldStrength:null!==(X=ae.attractFieldStrength)&&void 0!==X?X:50,attractFieldRadius:null!==(Y=ae.attractFieldRadius)&&void 0!==Y?Y:80,turbulenceIntensity:null!==(z=ae.turbulenceIntensity)&&void 0!==z?z:30,turbulenceScale:null!==(k=ae.turbulenceScale)&&void 0!==k?k:50,affectNewSplats:!1!==ae.affectNewSplats,affectExistingFluid:null!==(G=ae.affectExistingFluid)&&void 0!==G&&G,edgeGlow:null!==(V=ae.edgeGlow)&&void 0!==V&&V,edgeGlowIntensity:null!==(H=ae.edgeGlowIntensity)&&void 0!==H?H:.5,edgeGlowDistance:null!==(W=ae.edgeGlowDistance)&&void 0!==W?W:15,edgeGlowMatchFluid:null===(q=ae.edgeGlowMatchFluid)||void 0===q||q,edgeGlowColor:null!==($=ae.edgeGlowColor)&&void 0!==$?$:"#ffffff"},se={mode:null!==(J=t.cursorMode)&&void 0!==J?J:"default",dotSize:null!==(j=t.dotCursor?.size)&&void 0!==j?j:10,dotColor:null!==(K=t.dotCursor?.color)&&void 0!==K?K:"#ffffff",crosshairThickness:null!==(Q=t.crosshairCursor?.thickness)&&void 0!==Q?Q:1,crosshairColor:null!==(Z=t.crosshairCursor?.color)&&void 0!==Z?Z:"#ffffff",siblingHoverMode:null!==(ee=t.siblingHoverMode)&&void 0!==ee&&ee},ue=t.scrollAnimations||{},ce=null!==(te=ue.enabled)&&void 0!==te&&te,fe=null!==(ne=ue.rules)&&void 0!==ne?ne:[];let de=null!==(oe=t.cssSaturate)&&void 0!==oe?oe:100;const me=1,ve=1,he=1,ge=1,pe=re.PRESSURE_ITERATIONS,xe=!1,Te=60,Ee=!1;let Re=0,ye=[];function be(){if(le.enabled&&le.selectors)try{const t=document.querySelectorAll(le.selectors);ye=Array.from(t).map(t=>function(t){const n=e.getBoundingClientRect(),o=t.getBoundingClientRect();return{x:(o.left-n.left)/n.width,y:1-(o.bottom-n.top)/n.height,width:o.width/n.width,height:o.height/n.height,px:o.left-n.left,py:o.top-n.top,pWidth:o.width,pHeight:o.height}}(t))}catch(e){console.warn("Invalid element selectors:",e),ye=[]}else ye=[]}let Se=Math.random(),we=Date.now();function Me(){let t=[];ie.negativeBloom&&t.push("invert(1)"),t.push(`saturate(${de}%)`),e.style.filter=t.join(" ")}e.style.mixBlendMode=ie.blendMode,Me();class De{constructor(){this.id=-1,this.texcoordX=0,this.texcoordY=0,this.prevTexcoordX=0,this.prevTexcoordY=0,this.deltaX=0,this.deltaY=0,this.down=!1,this.moved=!1,this.color={r:.5,g:.2,b:.8},this.distanceSinceColorChange=0}}let Fe=[new De];function _e(e,t,n,o,r){if(!function(e,t,n,o){const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,t,4,4,0,n,o,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER);return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(i),e.deleteTexture(r),a===e.FRAMEBUFFER_COMPLETE}(e,t,n,o)){if(r)switch(t){case e.R16F:return _e(e,e.RG16F,e.RG,o,r);case e.RG16F:return _e(e,e.RGBA16F,e.RGBA,o,r)}return{internalFormat:e.RGBA,format:e.RGBA}}return{internalFormat:t,format:n}}const Le=function(e){const t={alpha:!0,depth:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!1};let n=e.getContext("webgl2",t);const o=!!n;if(o||(n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),!n)return console.error("WebGL not supported"),null;let r,i,a,l,s;if(o)n.getExtension("EXT_color_buffer_float"),i=n.getExtension("OES_texture_float_linear"),r=n.HALF_FLOAT;else{const e=n.getExtension("OES_texture_half_float");r=e?e.HALF_FLOAT_OES:n.UNSIGNED_BYTE,i=n.getExtension("OES_texture_half_float_linear")}return n.clearColor(0,0,0,1),o?(a=_e(n,n.RGBA16F,n.RGBA,r,o),l=_e(n,n.RG16F,n.RG,r,o),s=_e(n,n.R16F,n.RED,r,o)):(a={internalFormat:n.RGBA,format:n.RGBA},l={internalFormat:n.RGBA,format:n.RGBA},s={internalFormat:n.RGBA,format:n.RGBA}),{gl:n,ext:{formatRGBA:a,formatRG:l,formatR:s,halfFloatTexType:r,supportLinearFiltering:!!i},isWebGL2:o}}(e);if(!Le)return;const{gl:Ae,ext:Be,isWebGL2:Ce}=Le;function Oe(e,t){const n=Ae.createShader(e);return Ae.shaderSource(n,t),Ae.compileShader(n),Ae.getShaderParameter(n,Ae.COMPILE_STATUS)?n:(console.error("Shader error:",Ae.getShaderInfoLog(n)),Ae.deleteShader(n),null)}function Ue(e,t){const n=Oe(Ae.VERTEX_SHADER,e),o=Oe(Ae.FRAGMENT_SHADER,t);if(!n||!o)return null;const r=Ae.createProgram();if(Ae.attachShader(r,n),Ae.attachShader(r,o),Ae.linkProgram(r),!Ae.getProgramParameter(r,Ae.LINK_STATUS))return console.error("Program error:",Ae.getProgramInfoLog(r)),null;const i={},a=Ae.getProgramParameter(r,Ae.ACTIVE_UNIFORMS);for(let e=0;e<a;e++){const t=Ae.getActiveUniform(r,e).name;i[t]=Ae.getUniformLocation(r,t)}return{program:r,uniforms:i}}const Ie="\n        precision highp float;\n        attribute vec2 aPosition;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform vec2 texelSize;\n        \n        void main () {\n            vUv = aPosition * 0.5 + 0.5;\n            vL = vUv - vec2(texelSize.x, 0.0);\n            vR = vUv + vec2(texelSize.x, 0.0);\n            vT = vUv + vec2(0.0, texelSize.y);\n            vB = vUv - vec2(0.0, texelSize.y);\n            gl_Position = vec4(aPosition, 0.0, 1.0);\n        }\n    ",Pe="\n        precision highp float;\n        attribute vec2 aPosition;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        uniform vec2 texelSize;\n        \n        void main () {\n            vUv = aPosition * 0.5 + 0.5;\n            float offset = 1.33333333;\n            vL = vUv - texelSize * offset;\n            vR = vUv + texelSize * offset;\n            gl_Position = vec4(aPosition, 0.0, 1.0);\n        }\n    ",Ne={copy:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        \n        void main () {\n            gl_FragColor = texture2D(uTexture, vUv);\n        }\n    "),clear:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform float value;\n        \n        void main () {\n            gl_FragColor = value * texture2D(uTexture, vUv);\n        }\n    "),display:Ue(Ie,"\n        precision highp float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform sampler2D uBloom;\n        uniform bool useBloom;\n        \n        void main () {\n            vec3 c = texture2D(uTexture, vUv).rgb;\n            if (useBloom) {\n                vec3 bloom = texture2D(uBloom, vUv).rgb;\n                c += bloom;\n            }\n            float a = max(c.r, max(c.g, c.b));\n            gl_FragColor = vec4(c, a);\n        }\n    "),bloomPrefilter:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform vec3 curve;\n        uniform float threshold;\n        \n        void main () {\n            vec3 c = texture2D(uTexture, vUv).rgb;\n            float br = max(c.r, max(c.g, c.b));\n            float rq = clamp(br - curve.x, 0.0, curve.y);\n            rq = curve.z * rq * rq;\n            c *= max(rq, br - threshold) / max(br, 0.0001);\n            gl_FragColor = vec4(c, 0.0);\n        }\n    "),bloomBlur:Ue(Pe,"\n        precision mediump float;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        \n        void main () {\n            vec4 sum = vec4(0.0);\n            sum += texture2D(uTexture, vL);\n            sum += texture2D(uTexture, vR);\n            sum *= 0.5;\n            gl_FragColor = sum;\n        }\n    "),bloomFinal:Ue(Pe,"\n        precision mediump float;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vUv;\n        uniform sampler2D uTexture;\n        uniform float intensity;\n        \n        void main () {\n            vec4 sum = vec4(0.0);\n            sum += texture2D(uTexture, vL);\n            sum += texture2D(uTexture, vR);\n            sum *= 0.5 * intensity;\n            gl_FragColor = sum;\n        }\n    "),splat:Ue(Ie,"\n        precision highp float;\n        varying vec2 vUv;\n        uniform sampler2D uTarget;\n        uniform float aspectRatio;\n        uniform vec3 color;\n        uniform vec2 point;\n        uniform float radius;\n        \n        void main () {\n            vec2 p = vUv - point.xy;\n            p.x *= aspectRatio;\n            vec3 splat = exp(-dot(p, p) / radius) * color;\n            vec3 base = texture2D(uTarget, vUv).xyz;\n            gl_FragColor = vec4(base + splat, 1.0);\n        }\n    "),advection:Ue(Ie,"\n        precision highp float;\n        varying vec2 vUv;\n        uniform sampler2D uVelocity;\n        uniform sampler2D uSource;\n        uniform vec2 texelSize;\n        uniform vec2 dyeTexelSize;\n        uniform float dt;\n        uniform float dissipation;\n        \n        void main () {\n            vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n            vec4 result = texture2D(uSource, coord);\n            float decay = 1.0 + dissipation * dt;\n            gl_FragColor = result / decay;\n        }\n    "),divergence:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uVelocity;\n        \n        void main () {\n            float L = texture2D(uVelocity, vL).x;\n            float R = texture2D(uVelocity, vR).x;\n            float T = texture2D(uVelocity, vT).y;\n            float B = texture2D(uVelocity, vB).y;\n            vec2 C = texture2D(uVelocity, vUv).xy;\n            if (vL.x < 0.0) { L = -C.x; }\n            if (vR.x > 1.0) { R = -C.x; }\n            if (vT.y > 1.0) { T = -C.y; }\n            if (vB.y < 0.0) { B = -C.y; }\n            float div = 0.5 * (R - L + T - B);\n            gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n        }\n    "),curl:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uVelocity;\n        \n        void main () {\n            float L = texture2D(uVelocity, vL).y;\n            float R = texture2D(uVelocity, vR).y;\n            float T = texture2D(uVelocity, vT).x;\n            float B = texture2D(uVelocity, vB).x;\n            float vorticity = R - L - T + B;\n            gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\n        }\n    "),vorticity:Ue(Ie,"\n        precision highp float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uVelocity;\n        uniform sampler2D uCurl;\n        uniform float curl;\n        uniform float dt;\n        \n        void main () {\n            float L = texture2D(uCurl, vL).x;\n            float R = texture2D(uCurl, vR).x;\n            float T = texture2D(uCurl, vT).x;\n            float B = texture2D(uCurl, vB).x;\n            float C = texture2D(uCurl, vUv).x;\n            vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n            force /= length(force) + 0.0001;\n            force *= curl * C;\n            force.y *= -1.0;\n            vec2 vel = texture2D(uVelocity, vUv).xy;\n            gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\n        }\n    "),pressure:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uPressure;\n        uniform sampler2D uDivergence;\n        \n        void main () {\n            float L = texture2D(uPressure, vL).x;\n            float R = texture2D(uPressure, vR).x;\n            float T = texture2D(uPressure, vT).x;\n            float B = texture2D(uPressure, vB).x;\n            float C = texture2D(uPressure, vUv).x;\n            float divergence = texture2D(uDivergence, vUv).x;\n            float pressure = (L + R + B + T - divergence) * 0.25;\n            gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n        }\n    "),gradientSubtract:Ue(Ie,"\n        precision mediump float;\n        varying vec2 vUv;\n        varying vec2 vL;\n        varying vec2 vR;\n        varying vec2 vT;\n        varying vec2 vB;\n        uniform sampler2D uPressure;\n        uniform sampler2D uVelocity;\n        \n        void main () {\n            float L = texture2D(uPressure, vL).x;\n            float R = texture2D(uPressure, vR).x;\n            float T = texture2D(uPressure, vT).x;\n            float B = texture2D(uPressure, vB).x;\n            vec2 velocity = texture2D(uVelocity, vUv).xy;\n            velocity.xy -= vec2(R - L, T - B);\n            gl_FragColor = vec4(velocity, 0.0, 1.0);\n        }\n    ")},Xe=Ae.createBuffer();Ae.bindBuffer(Ae.ARRAY_BUFFER,Xe),Ae.bufferData(Ae.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),Ae.STATIC_DRAW);const Ye=Ae.createBuffer();function ze(e,t=!1){null==e?(Ae.viewport(0,0,Ae.drawingBufferWidth,Ae.drawingBufferHeight),Ae.bindFramebuffer(Ae.FRAMEBUFFER,null)):(Ae.viewport(0,0,e.width,e.height),Ae.bindFramebuffer(Ae.FRAMEBUFFER,e.fbo)),t&&(Ae.clearColor(0,0,0,1),Ae.clear(Ae.COLOR_BUFFER_BIT)),Ae.bindBuffer(Ae.ARRAY_BUFFER,Xe),Ae.bindBuffer(Ae.ELEMENT_ARRAY_BUFFER,Ye),Ae.enableVertexAttribArray(0),Ae.vertexAttribPointer(0,2,Ae.FLOAT,!1,0,0),Ae.drawElements(Ae.TRIANGLES,6,Ae.UNSIGNED_SHORT,0)}let ke,Ge,Ve,He,We,qe;Ae.bindBuffer(Ae.ELEMENT_ARRAY_BUFFER,Ye),Ae.bufferData(Ae.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),Ae.STATIC_DRAW);let $e=[];function Je(e){let t=Ae.drawingBufferWidth/Ae.drawingBufferHeight;t<1&&(t=1/t);const n=Math.round(e),o=Math.round(e*t);return Ae.drawingBufferWidth>Ae.drawingBufferHeight?{width:o,height:n}:{width:n,height:o}}function je(e,t,n,o,r,i){Ae.activeTexture(Ae.TEXTURE0);const a=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,a),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,i),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,i),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texImage2D(Ae.TEXTURE_2D,0,n,e,t,0,o,r,null);const l=Ae.createFramebuffer();return Ae.bindFramebuffer(Ae.FRAMEBUFFER,l),Ae.framebufferTexture2D(Ae.FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Ae.TEXTURE_2D,a,0),Ae.viewport(0,0,e,t),Ae.clear(Ae.COLOR_BUFFER_BIT),{texture:a,fbo:l,width:e,height:t,texelSizeX:1/e,texelSizeY:1/t,attach:e=>(Ae.activeTexture(Ae.TEXTURE0+e),Ae.bindTexture(Ae.TEXTURE_2D,a),e)}}function Ke(e,t,n,o,r,i){let a=je(e,t,n,o,r,i),l=je(e,t,n,o,r,i);return{width:e,height:t,texelSizeX:a.texelSizeX,texelSizeY:a.texelSizeY,get read(){return a},set read(e){a=e},get write(){return l},set write(e){l=e},swap(){const e=a;a=l,l=e}}}const Qe=e.closest(".fgb-fluid-group");let Ze,et=0,tt=0;function nt(){const t=Qe.offsetWidth||300,n=Qe.offsetHeight||200;if(Math.abs(t-et)>1||Math.abs(n-tt)>1){const o=4096,r=Math.min(Math.max(t,100),o),i=Math.min(Math.max(n,100),o);return e.width=r,e.height=i,et=t,tt=n,!0}return!1}if(window.addEventListener("resize",function(){clearTimeout(Ze),Ze=setTimeout(function(){nt()&&at(),be()},100)}),le.enabled&&le.trackScroll&&window.addEventListener("scroll",function(){be()},{passive:!0}),le.enabled&&setTimeout(be,200),ce&&fe.length>0){function ot(e,t,n,o,r){return e<=t?o:e>=n?r:o+(e-t)/(n-t)*(r-o)}function rt(e,t){switch(e){case"colorSaturation":ie.saturation=t;break;case"colorBrightness":ie.brightness=t;break;case"fadeSpeed":re.FADE_SPEED=t;break;case"curl":re.CURL=t;break;case"splatRadius":re.SPLAT_RADIUS=t;break;case"splatForce":re.SPLAT_FORCE=t;break;case"projectionDistance":re.PROJECTION_DISTANCE=t;break;case"cssSaturate":de=t,Me()}}function it(){const e=window.scrollY||window.pageYOffset;for(const t of fe){const n=ot(e,t.scrollStart,t.scrollEnd,t.valueStart,t.valueEnd);rt(t.property,n)}}it(),window.addEventListener("scroll",it,{passive:!0})}function at(){const e=Je(re.SIM_RESOLUTION),t=Je(re.DYE_RESOLUTION),n=Be.halfFloatTexType,o=Be.formatRGBA,r=Be.formatRG,i=Be.formatR,a=Be.supportLinearFiltering?Ae.LINEAR:Ae.NEAREST;ke=Ke(t.width,t.height,o.internalFormat,o.format,n,a),Ge=Ke(e.width,e.height,r.internalFormat,r.format,n,a),Ve=je(e.width,e.height,i.internalFormat,i.format,n,Ae.NEAREST),He=je(e.width,e.height,i.internalFormat,i.format,n,Ae.NEAREST),We=Ke(e.width,e.height,i.internalFormat,i.format,n,Ae.NEAREST),function(){const e=Je(re.BLOOM_RESOLUTION),t=Be.halfFloatTexType,n=Be.formatRGBA,o=Be.supportLinearFiltering?Ae.LINEAR:Ae.NEAREST;qe=je(e.width,e.height,n.internalFormat,n.format,t,o),$e.length=0;for(let r=0;r<re.BLOOM_ITERATIONS;r++){const i=e.width>>r+1,a=e.height>>r+1;if(i<2||a<2)break;const l=je(i,a,n.internalFormat,n.format,t,o);$e.push(l)}}()}function lt(){let e;const t=Math.min(ie.saturation*ie.saturationBoost,1);switch(ie.colorMode||"rainbow"){case"rainbow":e=st(Math.random(),t,1);break;case"huerange":const n=ie.hueMin/360,o=ie.hueMax/360;let r;if(n<=o)r=n+Math.random()*(o-n);else{const e=1-n+o;r=n+Math.random()*e,r>1&&(r-=1)}e=st(r,t,1);break;case"gradient":Se+=.01*ie.gradientSpeed,Se>1&&(Se-=1),e=st(Se,t,1);break;default:e=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:1,g:0,b:1}}(ie.fixedColor||"#ff00ff")}if(e.r*=ie.brightness,e.g*=ie.brightness,e.b*=ie.brightness,ie.preventOverblending){const t=ie.maxColorIntensity;e.r=Math.min(e.r,t),e.g=Math.min(e.g,t),e.b=Math.min(e.b,t)}return ie.darkMode&&(e.r=-e.r,e.g=-e.g,e.b=-e.b),e}function st(e,t,n){let o,r,i;const a=Math.floor(6*e),l=6*e-a,s=n*(1-t),u=n*(1-l*t),c=n*(1-(1-l)*t);switch(a%6){case 0:o=n,r=c,i=s;break;case 1:o=u,r=n,i=s;break;case 2:o=s,r=n,i=c;break;case 3:o=s,r=u,i=n;break;case 4:o=c,r=s,i=n;break;case 5:o=n,r=s,i=u}return{r:o,g:r,b:i}}nt(),at();let ut=Date.now();function ct(t,n,o,r,i){we=Date.now(),Ae.useProgram(Ne.splat.program),Ae.uniform1i(Ne.splat.uniforms.uTarget,Ge.read.attach(0)),Ae.uniform1f(Ne.splat.uniforms.aspectRatio,e.width/e.height),Ae.uniform2f(Ne.splat.uniforms.point,t,n),Ae.uniform3f(Ne.splat.uniforms.color,o,r,0),Ae.uniform1f(Ne.splat.uniforms.radius,function(t){const n=e.width/e.height;return n>1&&(t*=n),t}(re.SPLAT_RADIUS/100)),ze(Ge.write),Ge.swap(),Ae.uniform1i(Ne.splat.uniforms.uTarget,ke.read.attach(0)),Ae.uniform3f(Ne.splat.uniforms.color,i.r,i.g,i.b),ze(ke.write),ke.swap()}se.siblingHoverMode?(document.addEventListener("mousemove",t=>{const n=e.getBoundingClientRect();t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom&&gt(Fe[0],t.clientX-n.left,t.clientY-n.top)}),document.addEventListener("mousedown",t=>{const n=e.getBoundingClientRect();if(t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom){const e=Fe[0];e.down=!0,e.color=lt()}}),document.addEventListener("mouseup",()=>{Fe[0].down=!1})):(Qe.addEventListener("mousemove",t=>{const n=Fe[0],o=e.getBoundingClientRect();gt(n,t.clientX-o.left,t.clientY-o.top)}),Qe.addEventListener("mousedown",()=>{const e=Fe[0];e.down=!0,e.color=lt()}),Qe.addEventListener("mouseup",()=>{Fe[0].down=!1}));let ft=null,dt=null,mt=null;function vt(e,t,n){const o=se.mode;"dot"===o&&ft?n?(ft.style.display="block",ft.style.left=e+"px",ft.style.top=t+"px"):ft.style.display="none":"crosshair"===o&&dt&&mt&&(n?(dt.style.display="block",mt.style.display="block",dt.style.top=t+"px",mt.style.left=e+"px"):(dt.style.display="none",mt.style.display="none"))}function ht(t,n,o,r){t.id=n,t.down=!0,t.moved=!1,t.texcoordX=o/e.width,t.texcoordY=1-r/e.height,t.prevTexcoordX=t.texcoordX,t.prevTexcoordY=t.texcoordY,t.deltaX=0,t.deltaY=0,t.color=lt()}function gt(t,n,o){if(t.prevTexcoordX=t.texcoordX,t.prevTexcoordY=t.texcoordY,t.texcoordX=n/e.width,t.texcoordY=1-o/e.height,t.deltaX=function(t){const n=e.width/e.height;return n<1&&(t*=n),t}(t.texcoordX-t.prevTexcoordX),t.deltaY=function(t){const n=e.width/e.height;return(n>1||n<1)&&(t/=n),t}(t.texcoordY-t.prevTexcoordY),t.moved=Math.abs(t.deltaX)>0||Math.abs(t.deltaY)>0,t.moved){const n=t.deltaX*e.width,o=t.deltaY*e.height,r=Math.sqrt(n*n+o*o);t.distanceSinceColorChange+=r;const i=ie.colorChangeDistance;(0===i||t.distanceSinceColorChange>=i)&&(t.color=lt(),t.distanceSinceColorChange=0)}}"default"!==se.mode&&(function(){const e=se.mode;"hidden"===e?Qe.style.cursor="none":"dot"===e?(Qe.style.cursor="none",ft=document.createElement("div"),ft.className="fgb-dot-cursor",ft.style.cssText=`\n                position: fixed;\n                pointer-events: none;\n                z-index: 999999;\n                width: ${se.dotSize}px;\n                height: ${se.dotSize}px;\n                background-color: ${se.dotColor};\n                border-radius: 50%;\n                transform: translate(-50%, -50%);\n                display: none;\n            `,document.body.appendChild(ft)):"crosshair"===e&&(Qe.style.cursor="none",dt=document.createElement("div"),dt.className="fgb-crosshair-h",dt.style.cssText=`\n                position: fixed;\n                left: 0;\n                right: 0;\n                height: ${se.crosshairThickness}px;\n                background-color: ${se.crosshairColor};\n                pointer-events: none;\n                z-index: 999999;\n                display: none;\n            `,document.body.appendChild(dt),mt=document.createElement("div"),mt.className="fgb-crosshair-v",mt.style.cssText=`\n                position: fixed;\n                top: 0;\n                bottom: 0;\n                width: ${se.crosshairThickness}px;\n                background-color: ${se.crosshairColor};\n                pointer-events: none;\n                z-index: 999999;\n                display: none;\n            `,document.body.appendChild(mt))}(),Qe.addEventListener("mouseenter",()=>{"dot"===se.mode&&ft?ft.style.display="block":"crosshair"===se.mode&&(dt&&(dt.style.display="block"),mt&&(mt.style.display="block"))}),Qe.addEventListener("mouseleave",()=>{vt(0,0,!1)}),window.addEventListener("mousemove",e=>{const t=Qe.getBoundingClientRect(),n=e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom;vt(e.clientX,e.clientY,n)})),document.addEventListener("touchstart",t=>{const n=t.touches;for(;n.length>=Fe.length;)Fe.push(new De);for(let t=0;t<n.length;t++){const o=e.getBoundingClientRect(),r=(n[t].clientX-o.left)*(e.width/o.width),i=(n[t].clientY-o.top)*(e.height/o.height);ht(Fe[t+1],n[t].identifier,r,i)}},{passive:!0}),document.addEventListener("touchmove",t=>{const n=t.touches;for(let t=0;t<n.length;t++){const o=Fe[t+1];if(!o||!o.down)continue;const r=e.getBoundingClientRect();gt(o,(n[t].clientX-r.left)*(e.width/r.width),(n[t].clientY-r.top)*(e.height/r.height))}},{passive:!0}),document.addEventListener("touchend",e=>{const t=e.changedTouches;for(let e=0;e<t.length;e++){const n=Fe.find(n=>n.id===t[e].identifier);n&&(n.down=!1)}},{passive:!0}),n&&0!==n.length?n.forEach(t=>{const n=e=>!e||e.length<2?0:e[0]+Math.random()*(e[1]-e[0]),o=t.timing?.delay||0,r=t.timing?.duration||500,i=t.timing?.repeat||0,a=t.timing?.repeatDelay||0,l=!1!==t.randomizeColor?null:lt(),s=()=>{const o=(t.x+n(t.random?.x))/100,i=1-(t.y+n(t.random?.y))/100,a=n(t.random?.angle)*(Math.PI/180),s=n(t.random?.speed),u=(t.props?.speed||1)+s,c=1+n(t.random?.size)/100,f=n(t.random?.force),d=(t.force||1)+f,m=function(t,n,o,r,i=1){const a=[],l=t.props||{},s=i||1;switch(t.type){case"stroke":{const t=(l.length||100)*s/e.width,i=(l.angle||0)*Math.PI/180+r,u=30;for(let e=0;e<=u;e++){const r=e/u;a.push({x:n+(r-.5)*t*Math.cos(i),y:o+(r-.5)*t*Math.sin(i)})}break}case"circle":{const t=(l.radius||50)*s/e.width,i=36;for(let e=0;e<=i;e++){const l=e/i*Math.PI*2+r;a.push({x:n+Math.cos(l)*t,y:o+Math.sin(l)*t})}break}case"ellipse":{const t=(l.radiusX||60)*s/e.width,i=(l.radiusY||40)*s/e.height,u=(l.rotation||0)*Math.PI/180+r,c=36;for(let e=0;e<=c;e++){const r=e/c*Math.PI*2,l=Math.cos(r)*t,s=Math.sin(r)*i;a.push({x:n+l*Math.cos(u)-s*Math.sin(u),y:o+l*Math.sin(u)+s*Math.cos(u)})}break}case"rectangle":{const t=(l.width||80)*s/e.width,i=(l.height||50)*s/e.height,u=(l.rotation||0)*Math.PI/180+r,c=[[-t/2,-i/2],[t/2,-i/2],[t/2,i/2],[-t/2,i/2],[-t/2,-i/2]],f=8;for(let e=0;e<4;e++)for(let t=0;t<=f;t++){const r=t/f,i=c[e][0]+r*(c[e+1][0]-c[e][0]),l=c[e][1]+r*(c[e+1][1]-c[e][1]);a.push({x:n+i*Math.cos(u)-l*Math.sin(u),y:o+i*Math.sin(u)+l*Math.cos(u)})}break}case"svg":case"path":{const e=l.pathData||l.points||"",t=(l.rotation||0)*Math.PI/180+r,i=l.scale||1;let s=[],u=!1;if(Array.isArray(e))s=e,u=!0;else if("string"==typeof e){const t=e.match(/[-\d.]+/g);if(t)for(let e=0;e<t.length-1;e+=2)s.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])})}if(u&&s.length>0){const e=s.reduce((e,t)=>e+t.x,0)/s.length,n=s.reduce((e,t)=>e+t.y,0)/s.length;for(const o of s){const r=(e+(o.x-e)*i)/100-.5,l=1-(n+(o.y-n)*i)/100-.5;a.push({x:.5+r*Math.cos(t)-l*Math.sin(t),y:.5+r*Math.sin(t)+l*Math.cos(t)})}}else for(const e of s){const r=.002*i,l=e.x*r,s=e.y*r;a.push({x:n+l*Math.cos(t)-s*Math.sin(t),y:o+l*Math.sin(t)+s*Math.cos(t)})}break}}return a}(t,o,i,a,c);let v;v="fixed"===t.colorMode&&t.color?(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null})(t.color)||lt():l||lt(),function(e,t,n,o,r,i){if(e.length<2)return;const a=performance.now(),l=400*n*(r||1);let s=e[0].x,u=e[0].y;const c=i||0;requestAnimationFrame(function n(r){const i=r-a,f=Math.min(i/t,1),d=f*(e.length-1),m=Math.floor(d),v=d-m,h=e[Math.min(m,e.length-1)],g=e[Math.min(m+1,e.length-1)],p=v*v*(3-2*v),x=h.x+p*(g.x-h.x),T=h.y+p*(g.y-h.y),E=(x-s)*l,R=(T-u)*l;let y=o;if(c>0){const e=f*c;y={r:(o.r+.5*e)%1,g:(o.g+.3*e)%1,b:(o.b+.7*e)%1}}(Math.abs(E)>.01||Math.abs(R)>.01)&&ct(x,T,E,R,y),s=x,u=T,f<1&&requestAnimationFrame(n)})}(m,r,u,v,d,t.colorSpeed)},u=e=>{setTimeout(s,o+e*(r+a))};u(0);for(let e=1;e<=i;e++)u(e)}):function(e){for(let t=0;t<e;t++){const e=lt();e.r*=10,e.g*=10,e.b*=10,ct(Math.random(),Math.random(),1e3*(Math.random()-.5),1e3*(Math.random()-.5),e)}}(parseInt(5*Math.random())+5),function t(n){if(Ee)return void requestAnimationFrame(t);if(xe){if(n-Re<1e3/Te)return void requestAnimationFrame(t);Re=n}const o=function(){const e=Date.now();let t=(e-ut)/1e3;return t=Math.min(t,.016666),ut=e,t*me}();var r;Fe.forEach(t=>{t.moved&&(t.moved=!1,function(t){let n=t.deltaX*re.SPLAT_FORCE*re.PROJECTION_DISTANCE*ve,o=t.deltaY*re.SPLAT_FORCE*re.PROJECTION_DISTANCE*ve,r=t.color;if(le.enabled&&le.affectNewSplats){const i=function(t,n){if(!le.enabled||0===ye.length)return{blocked:!1,forceX:0,forceY:0,opacity:1};const o=le.mode;let r={blocked:!1,forceX:0,forceY:0,opacity:1};for(const i of ye){const a=t>=i.x&&t<=i.x+i.width,l=n>=i.y&&n<=i.y+i.height,s=a&&l,u=i.x+i.width/2,c=i.y+i.height/2,f=(e.width,e.height,(t-u)*e.width),d=(n-c)*e.height,m=Math.sqrt(f*f+d*d),v=i.pWidth/2,h=i.pHeight/2,g=s?0:Math.max(0,Math.min(Math.abs((t-u)*e.width)-v,Math.abs((n-c)*e.height)-h));switch(o){case"hardCorner":s&&(r.blocked=!0,r.opacity=0);break;case"softEdge":const e=le.softEdgeRadius;s?(r.blocked=!0,r.opacity=0):g<e&&(r.opacity=Math.min(r.opacity,g/e));break;case"forceField":const t=le.forceFieldRadius;if(m<t+v){const e=(1-m/(t+v))*le.forceFieldStrength,n=Math.atan2(d,f);r.forceX+=Math.cos(n)*e,r.forceY+=Math.sin(n)*e}s&&(r.blocked=!0);break;case"attractField":const n=le.attractFieldRadius;if(m<n+v&&!s){const e=(1-m/(n+v))*le.attractFieldStrength,t=Math.atan2(d,f);r.forceX-=Math.cos(t)*e,r.forceY-=Math.sin(t)*e}break;case"turbulence":const o=i.pWidth,a=le.turbulenceIntensity,l=le.turbulenceScale;if(m<2*o&&!s){const e=Math.atan2(d,f)+Math.PI/2,t=(1-m/(2*o))*a;r.forceX+=Math.cos(e)*t*(.5*Math.sin(Date.now()/l)+.5),r.forceY+=Math.sin(e)*t*(.5*Math.cos(Date.now()/l)+.5)}}}return r}(t.texcoordX,t.texcoordY);if(i.blocked)return;n+=i.forceX,o+=i.forceY,r={r:t.color.r*i.opacity,g:t.color.g*i.opacity,b:t.color.b*i.opacity}}ct(t.texcoordX,t.texcoordY,n,o,r)}(t))}),function(t){Ae.disable(Ae.BLEND),Ae.useProgram(Ne.curl.program),Ae.uniform2f(Ne.curl.uniforms.texelSize,Ge.texelSizeX,Ge.texelSizeY),Ae.uniform1i(Ne.curl.uniforms.uVelocity,Ge.read.attach(0)),ze(He),Ae.useProgram(Ne.vorticity.program),Ae.uniform2f(Ne.vorticity.uniforms.texelSize,Ge.texelSizeX,Ge.texelSizeY),Ae.uniform1i(Ne.vorticity.uniforms.uVelocity,Ge.read.attach(0)),Ae.uniform1i(Ne.vorticity.uniforms.uCurl,He.attach(1)),Ae.uniform1f(Ne.vorticity.uniforms.curl,re.CURL*ge),Ae.uniform1f(Ne.vorticity.uniforms.dt,t),ze(Ge.write),Ge.swap(),Ae.useProgram(Ne.divergence.program),Ae.uniform2f(Ne.divergence.uniforms.texelSize,Ge.texelSizeX,Ge.texelSizeY),Ae.uniform1i(Ne.divergence.uniforms.uVelocity,Ge.read.attach(0)),ze(Ve),Ae.useProgram(Ne.clear.program),Ae.uniform1i(Ne.clear.uniforms.uTexture,We.read.attach(0)),Ae.uniform1f(Ne.clear.uniforms.value,re.PRESSURE),ze(We.write),We.swap(),Ae.useProgram(Ne.pressure.program),Ae.uniform2f(Ne.pressure.uniforms.texelSize,Ge.texelSizeX,Ge.texelSizeY),Ae.uniform1i(Ne.pressure.uniforms.uDivergence,Ve.attach(0));for(let e=0;e<pe;e++)Ae.uniform1i(Ne.pressure.uniforms.uPressure,We.read.attach(1)),ze(We.write),We.swap();Ae.useProgram(Ne.gradientSubtract.program),Ae.uniform2f(Ne.gradientSubtract.uniforms.texelSize,Ge.texelSizeX,Ge.texelSizeY),Ae.uniform1i(Ne.gradientSubtract.uniforms.uPressure,We.read.attach(0)),Ae.uniform1i(Ne.gradientSubtract.uniforms.uVelocity,Ge.read.attach(1)),ze(Ge.write),Ge.swap(),Ae.useProgram(Ne.advection.program),Ae.uniform2f(Ne.advection.uniforms.texelSize,Ge.texelSizeX,Ge.texelSizeY),Ae.uniform2f(Ne.advection.uniforms.dyeTexelSize,Ge.texelSizeX,Ge.texelSizeY);const n=Ge.read.attach(0);Ae.uniform1i(Ne.advection.uniforms.uVelocity,n),Ae.uniform1i(Ne.advection.uniforms.uSource,n),Ae.uniform1f(Ne.advection.uniforms.dt,t);let o=re.VELOCITY_DISSIPATION;if(re.CALM_DOWN){const e=Date.now()-we;if(e>re.CALM_DOWN_DELAY){const t=Math.min((e-re.CALM_DOWN_DELAY)/1e3,1);o=re.VELOCITY_DISSIPATION*(1-t)+re.CALM_DOWN_STRENGTH*t}}Ae.uniform1f(Ne.advection.uniforms.dissipation,o),ze(Ge.write),Ge.swap(),Ae.uniform2f(Ne.advection.uniforms.dyeTexelSize,ke.texelSizeX,ke.texelSizeY),Ae.uniform1i(Ne.advection.uniforms.uVelocity,Ge.read.attach(0)),Ae.uniform1i(Ne.advection.uniforms.uSource,ke.read.attach(1));const r=re.DENSITY_DISSIPATION/re.FADE_SPEED*he;Ae.uniform1f(Ne.advection.uniforms.dissipation,r),ze(ke.write),ke.swap(),le.enabled&&le.affectExistingFluid&&ye.length>0&&function(){const t=le.mode;for(const n of ye){const o=n.x+n.width/2,r=n.y+n.height/2;switch(t){case"hardCorner":case"softEdge":const i="softEdge"===t?.5*Math.max(n.width,n.height)+le.softEdgeRadius/e.width:.4*Math.max(n.width,n.height);Ae.useProgram(Ne.splat.program),Ae.uniform1i(Ne.splat.uniforms.uTarget,Ge.read.attach(0)),Ae.uniform1f(Ne.splat.uniforms.aspectRatio,e.width/e.height),Ae.uniform2f(Ne.splat.uniforms.point,o,r),Ae.uniform3f(Ne.splat.uniforms.color,0,0,0),Ae.uniform1f(Ne.splat.uniforms.radius,.5*i),ze(Ge.write),Ge.swap(),Ae.uniform1i(Ne.splat.uniforms.uTarget,ke.read.attach(0));const a="softEdge"===t?-.02:-.05;Ae.uniform3f(Ne.splat.uniforms.color,a,a,a),Ae.uniform1f(Ne.splat.uniforms.radius,.5*i),ze(ke.write),ke.swap();break;case"forceField":const l=le.forceFieldRadius/e.width+.5*n.width,s=.01*le.forceFieldStrength;Ae.useProgram(Ne.splat.program),Ae.uniform1i(Ne.splat.uniforms.uTarget,Ge.read.attach(0)),Ae.uniform1f(Ne.splat.uniforms.aspectRatio,e.width/e.height),Ae.uniform2f(Ne.splat.uniforms.point,o,r),Ae.uniform3f(Ne.splat.uniforms.color,s,s,0),Ae.uniform1f(Ne.splat.uniforms.radius,l),ze(Ge.write),Ge.swap();break;case"attractField":const u=le.attractFieldRadius/e.width+.5*n.width,c=.005*-le.attractFieldStrength;Ae.useProgram(Ne.splat.program),Ae.uniform1i(Ne.splat.uniforms.uTarget,Ge.read.attach(0)),Ae.uniform1f(Ne.splat.uniforms.aspectRatio,e.width/e.height),Ae.uniform2f(Ne.splat.uniforms.point,o,r),Ae.uniform3f(Ne.splat.uniforms.color,c,c,0),Ae.uniform1f(Ne.splat.uniforms.radius,u),ze(Ge.write),Ge.swap();break;case"turbulence":const f=n.width+le.turbulenceIntensity/e.width,d=.001*le.turbulenceIntensity,m=Date.now()/le.turbulenceScale,v=Math.sin(m)*d;Ae.useProgram(Ne.splat.program),Ae.uniform1i(Ne.splat.uniforms.uTarget,Ge.read.attach(0)),Ae.uniform1f(Ne.splat.uniforms.aspectRatio,e.width/e.height),Ae.uniform2f(Ne.splat.uniforms.point,o,r),Ae.uniform3f(Ne.splat.uniforms.color,v,.5*-v,0),Ae.uniform1f(Ne.splat.uniforms.radius,f),ze(Ge.write),Ge.swap()}}}()}(o),r=null,re.BLOOM&&$e.length>=2&&function(e,t){if($e.length<2)return;let n=t;Ae.disable(Ae.BLEND),Ae.useProgram(Ne.bloomPrefilter.program);const o=re.BLOOM_THRESHOLD*re.BLOOM_SOFT_KNEE+1e-4,r=re.BLOOM_THRESHOLD-o,i=2*o,a=.25/o;Ae.uniform3f(Ne.bloomPrefilter.uniforms.curve,r,i,a),Ae.uniform1f(Ne.bloomPrefilter.uniforms.threshold,re.BLOOM_THRESHOLD),Ae.uniform1i(Ne.bloomPrefilter.uniforms.uTexture,e.attach(0)),ze(n),Ae.useProgram(Ne.bloomBlur.program);for(let e=0;e<$e.length;e++){const t=$e[e];Ae.uniform2f(Ne.bloomBlur.uniforms.texelSize,n.texelSizeX,n.texelSizeY),Ae.uniform1i(Ne.bloomBlur.uniforms.uTexture,n.attach(0)),ze(t),n=t}Ae.blendFunc(Ae.ONE,Ae.ONE),Ae.enable(Ae.BLEND);for(let e=$e.length-2;e>=0;e--){const t=$e[e];Ae.uniform2f(Ne.bloomBlur.uniforms.texelSize,n.texelSizeX,n.texelSizeY),Ae.uniform1i(Ne.bloomBlur.uniforms.uTexture,n.attach(0)),Ae.viewport(0,0,t.width,t.height),ze(t),n=t}Ae.disable(Ae.BLEND),Ae.useProgram(Ne.bloomFinal.program),Ae.uniform2f(Ne.bloomFinal.uniforms.texelSize,n.texelSizeX,n.texelSizeY),Ae.uniform1i(Ne.bloomFinal.uniforms.uTexture,n.attach(0)),Ae.uniform1f(Ne.bloomFinal.uniforms.intensity,re.BLOOM_INTENSITY),ze(t)}(ke.read,qe),function(e){const t=null==e?Ae.drawingBufferWidth:e.width,n=null==e?Ae.drawingBufferHeight:e.height;Ae.useProgram(Ne.display.program),Ae.uniform2f(Ne.display.uniforms.texelSize,1/t,1/n),Ae.uniform1i(Ne.display.uniforms.uTexture,ke.read.attach(0)),re.BLOOM&&$e.length>=2?(Ae.uniform1i(Ne.display.uniforms.uBloom,qe.attach(1)),Ae.uniform1i(Ne.display.uniforms.useBloom,1)):Ae.uniform1i(Ne.display.uniforms.useBloom,0),ze(e)}(r),requestAnimationFrame(t)}()}(t,r,i)})});